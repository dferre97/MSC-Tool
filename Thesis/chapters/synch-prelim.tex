
\section{Prefixes}

\begin{definition}[Prefix]
	Let $\msc = (\Events,\procrel,\lhd,\lambda) \in \MSCs$ and consider
	$E \subseteq \Events$ such that $E$ is ${\le}$-\emph{downward-closed}, i.e,
	for all $(e,f) \in {\le}$ such that $f \in E$, we also have $e \in E$.
	Then, the MSC $M' = (E,{\procrel} \cap (E \times E),{\lhd} \cap (E \times E),\lambda')$,
	where $\lambda'$ is the restriction of $\Events$ to $E$, is called a \emph{prefix}
	of $\msc$. 	
\end{definition}

If we consider a set $E$ that is ${\onenpartial}$-\emph{downward-closed}, we call $M'$ a \emph{$\onen$ prefix}.
If the set $E$ is ${\nnbowtieofmsc\msc}$-\emph{downward-closed}, we call $M'$ a \emph{$\nn$ prefix}. Note that every $\onen$ or $\nn$ prefix is also a prefix, since $\le \subseteq {\onenpartial}$ and $\le \subseteq {\nnbowtieofmsc\msc}$.

Note that the empty MSC is a prefix of $\msc$.
We denote the set of prefixes of $\msc$ by $\Pref{\msc}$, whereas $\Prefonen{\msc}$ and $\Prefnn{\msc}$ are used for the $\onen$ and the $\nn$ variants, respectively.
This is extended to sets $L \subseteq \MSCs$ as expected, letting
$\Pref{L} = \bigcup_{\msc \in L} \Pref{\msc}$.

\begin{comment}

Let $\msc = (\Events,\procrel,\lhd,\lambda) \in \MSCs$ and consider
$E \subseteq \Events$ such that $E$ is ${\le}$-\emph{downward-closed}, i.e,
for all $(e,f) \in {\le}$ such that $f \in E$, we also have $e \in E$.
Then, the MSC $(E,{\procrel} \cap (E \times E),{\lhd} \cap (E \times E),\lambda')$,
where $\lambda'$ is the restriction of $\Events$ to $E$, is called a \emph{prefix}
of $\msc$. In particular, the empty MSC is a prefix of $\msc$.
We denote the set of prefixes of $\msc$ by $\Pref{\msc}$.
This is extended to sets $L \subseteq \MSCs$ as expected, letting
$\Pref{L} = \bigcup_{\msc \in L} \Pref{\msc}$.

\smallskip

Let $\msc = (\Events,\procrel,\lhd,\lambda) \in \onenMSCs$ and consider
$E \subseteq \Events$ such that $E$ is ${\onenpartial}$-\emph{downward-closed}, i.e,
for all $(e,f) \in {\onenpartial}$ such that $f \in E$, we also have $e \in E$.
Then, the MSC $(E,{\procrel} \cap (E \times E),{\lhd} \cap (E \times E),\lambda')$,
where $\lambda'$ is the restriction of $\Events$ to $E$, is called a \emph{$\onen$ prefix} of $\msc$. We denote the set of $\onen$ prefixes of $\msc$ by $\Prefonen{\msc}$.

\smallskip

Let $\msc = (\Events,\procrel,\lhd,\lambda) \in \nnMSCs$ and consider
$E \subseteq \Events$ such that $E$ is ${\nnbowtieofmsc\msc}$-\emph{downward-closed}, i.e,
for all $(e,f) \in {\nnbowtieofmsc\msc}$ such that $f \in E$, we also have $e \in E$.
Then, the MSC $(E,{\procrel} \cap (E \times E),{\lhd} \cap (E \times E),\lambda')$,
where $\lambda'$ is the restriction of $\Events$ to $E$, is called a \emph{$\nn$ prefix} of $\msc$. We denote the set of $\nn$ prefixes of $\msc$ by $\Prefnn{\msc}$.

\end{comment}

\section{Communicating Systems}

\begin{proposition}
	\label{prop:prefixes}
	For $\comsymb \in \{\asy, \oneone, \co, \none, \rsc\}$, every prefix of a $\comsymb$ MSC is a $\comsymb$ MSC.
\end{proposition}

Note that this proposition is not true for the $\onen$ and the $\nn$ communication models. Fig.\ref{fig:onen-prefix} shows an example of $\nn$ MSC with a prefix that is neither a $\nn$ MSC nor a $\onen$ MSC.

\begin{figure}[t]
	\captionsetup[subfigure]{justification=centering}
% \centering
\begin{subfigure}[t]{0.45\textwidth}\centering
	\begin{tikzpicture}[scale=1, every node/.style={transform shape}]
		\newproc{0}{p}{-1.5};
		\newproc{1}{q}{-1.5};
		\newproc{2}{r}{-1.5};

		\newmsgm{0}{1}{-0.5}{-0.5}{1}{0.3}{black};
		\newmsgm{0}{2}{-1.0}{-1.0}{2}{0.7}{black};

	\end{tikzpicture}
	\caption{A $\nn$ MSC $\msc$.}
\end{subfigure}
% \hfill
\begin{subfigure}[t]{0.45\textwidth}\centering
	\begin{tikzpicture}[scale=1, every node/.style={transform shape}]
		\newproc{0}{p}{-1.5};
		\newproc{1}{q}{-1.5};
		\newproc{2}{r}{-1.5};

		\newmsgum{0}{1}{-0.5}{1}{0.3}{black};
		\newmsgm{0}{2}{-1.0}{-1.0}{2}{0.7}{black};

	\end{tikzpicture}
	\caption{A prefix of $\msc$.}
\end{subfigure}
	\caption{A $\nn$ MSC with a prefix that is neither $\onen$ nor $\nn$.}
	\label{fig:onen-prefix}
\end{figure}

\begin{proposition}
	\label{prop:prefixes-onen}
	Every $\onen$ prefix of a $\onen$ MSC is a $\onen$ MSC.
\end{proposition}
\begin{proposition}
	\label{prop:prefixes-nn}
	Every $\nn$ prefix of a $\nn$ MSC is a $\nn$ MSC.
\end{proposition}

\begin{comment}

\begin{lemma}
	\label{lem:p2p-prefix}
	Every prefix of a \pp MSC is a \pp MSC.
\end{lemma}
\begin{proof}
Let $\msc = (\Events, \procrel, \lhd, \lambda) \in \ppMSCs$ and let $\msc_0 =
(\Events_0, \procrel_0, \lhd_0, \lambda_0)$ be a prefix of $\msc$, where $\Events_0 \subseteq \Events$, ${\rightarrow_0} \subseteq {\rightarrow}$, and ${\lhd_0} \subseteq {\lhd}$. Since $\msc$ is \pp, we have that for every pair $(e,f) \in {\lhd}$, such that $\lambda(e) = \sact{p}{q}{\msg}$ and $\lambda(f) = \ract{p}{q}{\msg}$, $\sametype{e}{\pqsAct{p}{q}}{\procrel^+} = \sametype{f}{\pqrAct{p}{q}}{\procrel^+}$. We show that, for every pair $(e,f) \in {\lhd_0}$, this property still holds. 
Since  ${\lhd_0} \subseteq {\lhd}$, every pair $(e,f)$ that belongs to $\lhd_0$ also belongs to $\lhd$, and we know that $\sametype{e}{\pqsAct{p}{q}}{\procrel^+} = \sametype{f}{\pqrAct{p}{q}}{\procrel^+}$. 
Because of the $\le$-downward-closeness of $\Events_0$, it is easy to see that $\sametype{e}{\pqsAct{p}{q}}{\procrel^+}=\sametype{e}{\pqsAct{p}{q}}{\procrel_0^+}$ and $\sametype{f}{\pqrAct{p}{q}}{\procrel^+}=\sametype{f}{\pqrAct{p}{q}}{\procrel_0^+}$.
\end{proof}

\begin{lemma}
\label{lem:co-prefix}
Every prefix of a causally ordered MSC is a causally ordered MSC.
\end{lemma}
\begin{proof}
Let $\msc = (\Events, \procrel, \lhd, \lambda) \in \coMSCs$ and let $\msc_0 =
(\Events_0, \procrel_0, \lhd_0, \lambda_0)$ be a prefix of $\msc$. By contradiction, suppose that $\msc_0$ is not a	causally ordered MSC. There must be two distinct $s,s' \in \Events_0$ such that $\lambda(s)=\pqsAct{\plh}{q}$, $\lambda(s')=\pqsAct{\plh}{q}$, $s \le_{\msc_0} s'$ and either
\begin{enumerate*}[label={(\roman*)}]
	\item $r' \procrel^+ r$, where $r$ and $r'$ are two receive events such that $s \lhd r$ and $s' \lhd r'$, or
	\item $s \in \Unm{\msc_0}$ and $s' \in \Matched{\msc_0}$.
\end{enumerate*}
In both cases, $\msc$ would also not be a causally ordered $\MSCs$, since $\Events_0 \subseteq \Events$, ${\rightarrow_0} \subseteq {\rightarrow}$, and ${\lhd_0} \subseteq {\lhd}$. This is a contradiction, thus $\msc_0$ has to be causally ordered.
\end{proof}

\begin{lemma}
	\label{lem:onen-prefix}
	Every $\onen$ prefix of a $\onen$ MSC is a $\onen$ MSC.
\end{lemma}
\begin{proof}
	Let $\msc = (\Events, \procrel, \lhd, \lambda) \in \onenMSCs$ and let $\msc_0 =
	(\Events_0, \procrel_0, \lhd_0, \lambda_0)$ be a $\onen$ prefix of $\msc$, where $\Events_0 \subseteq \Events$. Firstly, the $\onenpartial$-downward-closeness of $\Events_0$ guarantees that ${\msc_0}$ is still an MSC. We need to prove that it is a $\onen$ MSC. By contradiction, suppose that $\msc_0$ is not a $\onen$ MSC. Then, there are distinct $e,f \in \Events_0$ such that $e \onenpartial^{(\msc_0)} f \onenpartial^{(\msc_0)} e$, where $\onenpartial^{(\msc_0)} = (\procrel_0 \cup \lhd_0 \cup \onenrel_{\msc_0})^\ast$. As $\Events_0 \subseteq \Events$, we have that ${\rightarrow_0} \subseteq {\rightarrow}$, ${\lhd_0} \subseteq {\lhd}$, ${\onenrel_{\msc_0}} \subseteq {\onenrel}$. Clearly, $\onenpartial{(\msc_0)} \subseteq \onenpartial$, so $e \onenpartial f \onenpartial e$. This implies that $\msc$ is not a $\onen$ MSC, because $\onenpartial$ is cyclic, which is a contradiction. Hence $\msc_0$ is a $\onen$ MSC.
\end{proof}

\noindent Note that every $\onen$ prefix is also a prefix.

\begin{lemma}
	\label{lem:nn-prefix}
	Every $\nn$ prefix of a $\nn$ MSC is a $\nn$ MSC.
\end{lemma}
\begin{proof}
	Let $\msc = (\Events, \procrel, \lhd, \lambda) \in \nnMSCs$ and let $\msc_0 =
	(\Events_0, \procrel_0, \lhd_0, \lambda_0)$ be a $\nn$ prefix of $\msc$, where $\Events_0 \subseteq \Events$. Firstly, the $\nnbowtieofmsc\msc$-downward-closeness of $\Events_0$ guarantees that ${\msc_0}$ is still an MSC. We need to prove that it is a $\nn$ MSC. By contradiction, suppose that $\msc_0$ is not a $\nn$ MSC. Then, there are distinct $e,f \in \Events_0$ such that $e \nnbowtieofmsc{\msc_0} f \nnbowtieofmsc{\msc_0} e$. As $\Events_0 \subseteq \Events$, we have that ${\rightarrow_0} \subseteq {\rightarrow}$, ${\lhd_0} \subseteq {\lhd}$, ${\nnrel0} \subseteq {\nnrel}$. Clearly, $\nnbowtieofmsc{\msc_0} \subseteq\; \nnbowtieofmsc\msc$, so $e \nnbowtieofmsc\msc f \nnbowtieofmsc\msc e$. This implies that $\msc$ is not a $\nn$ MSC, because $\nnbowtieofmsc\msc$ is cyclic, which is a contradiction. Hence $\msc_0$ is a $\nn$ MSC.
\end{proof}

\noindent Note that every $\nn$ prefix is also a prefix.

\end{comment}

\begin{proposition}
	For all $\comsymb \in \{\oneone, \co, \none\}$, $\cL{\Sys}$ is prefix-closed:
	$\Pref{\cL{\Sys}} \subseteq \cL{\Sys}$.
\end{proposition}

\begin{proposition}
	$\onenL{\Sys}$ is $\onen$ prefix-closed:
	$\Prefonen{\onenL{\Sys}} \subseteq \onenL{\Sys}$.
\end{proposition}
\begin{proposition}
	$\nnL{\Sys}$ is $\nn$ prefix-closed:
	$\Prefnn{\nnL{\Sys}} \subseteq \nnL{\Sys}$.
\end{proposition}

\begin{comment}

Lemma~\ref{lem:prefix-closed} can be easily extendend to $\comsymb = \cosymb$.

\begin{lemma}\label{lem:co-prefix-closed}
	For all $\comsymb \in \{\ppsymb, \mbsymb, \cosymb\}$, $\cL{\Sys}$ is prefix-closed:
	$\Pref{\cL{\Sys}} \subseteq \cL{\Sys}$.
\end{lemma}
\begin{proof}
	Follows from Lemma~\ref{lem:co-prefix}.
\end{proof}

\begin{lemma}\label{lem:onen-prefix-closed}
	$\onenL{\Sys}$ is $\onen$ prefix-closed:
	$\Prefonen{\onenL{\Sys}} \subseteq \onenL{\Sys}$.
\end{lemma}
\begin{proof}
	Given a system $\System$, we have that $\onenL{\System} = \ppL{\System} \cap \onenMSCs$. Note that, because of how we defined a $\onen$ prefix, we have that $\Prefonen{\onenL{\Sys}} = \Pref{\onenL{\Sys}} \cap \onenMSCs$. Moreover, $\Pref{\onenL{\Sys}} \subseteq \Pref{\ppL{\Sys}}$, and $\Pref{\onenL{\Sys}} \subseteq \ppL{\Sys}$ for Lemma~\ref{lem:prefix-closed}. Putting everything together, $\Prefonen{\onenL{\Sys}} \subseteq \ppL{\Sys} \cap \onenMSCs = \onenL{\System}$.
\end{proof}

\begin{lemma}\label{lem:nn-prefix-closed}
	$\nnL{\Sys}$ is $\nn$ prefix-closed:
	$\Prefnn{\nnL{\Sys}} \subseteq \nnL{\Sys}$.
\end{lemma}
\begin{proof}
	Given a system $\System$, we have that $\nnL{\System} = \ppL{\System} \cap \nnMSCs$. Note that, because of how we defined a $\nn$ prefix, we have that $\Prefnn{\nnL{\Sys}} = \Pref{\nnL{\Sys}} \cap \nnMSCs$. Moreover, $\Pref{\nnL{\Sys}} \subseteq \Pref{\ppL{\Sys}}$, and $\Pref{\nnL{\Sys}} \subseteq \ppL{\Sys}$ for Lemma~\ref{lem:prefix-closed}. Putting everything together, $\Prefnn{\nnL{\Sys}} \subseteq \ppL{\Sys} \cap \nnMSCs = \nnL{\System}$.
\end{proof}

\end{comment}


\section{Model Checking}

\begin{theorem}
	\label{thm:bounded_model_checking}
	The bounded model-checking problem for $\comsymb \in \{$$\asy, $ $\oneone, $ $\co, $ $\none, $ $\onen, $ $\nn, $ $\rsc\}$ is decidable.
\end{theorem}

\begin{comment}

Knowing that $\coMSCs$ is MSO-definable, Theorem~\ref{thm:mailbox_bounded_model_checking} can be restated for $\comsymb = \cosymb$.

\begin{theorem}
	\label{thm:co_bounded_model_checking}
	The bounded model-checking problem for $\comsymb =  \cosymb$ is decidable.
\end{theorem}
\begin{proof}
By Proposition~\ref{prop:co_mso}, $\coMSCs=L(\coformula)$. Given a system $\System$, we have that $\coL{\System} = \ppL{\System} \cap L(\coformula)$. Therefore, we can rewrite the bounded model checking problem for $\comsymb = \cosymb$ as

\[\begin{array}{rl}
&\coL{\System} \cap \stwMSCs{k} \subseteq L(\phi)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap L(\coformula) \cap \stwMSCs{k} \subseteq L(\phi)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap \stwMSCs{k} \subseteq L(\phi) \cup L(\neg \coformula)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap \stwMSCs{k} \subseteq L(\phi \vee \neg \coformula)\,.
\end{array}\]
The latter is decidable due to Fact~\ref{p2p}.
\end{proof}

\begin{theorem}
	\label{thm:onen_bounded_model_checking}
	The bounded model-checking problem for $\comsymb =  \onensymb$ is decidable.
\end{theorem}
\begin{proof}
By Proposition~\ref{prop:onen_mso}, $\onenMSCs=L(\onenformula)$. Given a system $\System$, we have that $\onenL{\System} = \ppL{\System} \cap L(\onenformula)$. Therefore, we can rewrite the bounded model checking problem for $\comsymb = \onensymb$ as

\[\begin{array}{rl}
&\onenL{\System} \cap \stwMSCs{k} \subseteq L(\phi)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap L(\onenformula) \cap \stwMSCs{k} \subseteq L(\phi)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap \stwMSCs{k} \subseteq L(\phi) \cup L(\neg \onenformula)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap \stwMSCs{k} \subseteq L(\phi \vee \neg \onenformula)\,.
\end{array}\]
The latter is decidable due to Fact~\ref{p2p}.
\end{proof}

\begin{theorem}
	\label{thm:nn_bounded_model_checking}
	The bounded model-checking problem for $\comsymb =  \nnsymb$ is decidable.
\end{theorem}
\begin{proof}
By Proposition~\ref{prop:nn_mso}, $\nnMSCs=L(\nnformula)$. Given a system $\System$, we have that $\nnL{\System} = \ppL{\System} \cap L(\nnformula)$. Therefore, we can rewrite the bounded model checking problem for $\comsymb = \nnsymb$ as

\[\begin{array}{rl}
&\nnL{\System} \cap \stwMSCs{k} \subseteq L(\phi)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap L(\nnformula) \cap \stwMSCs{k} \subseteq L(\phi)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap \stwMSCs{k} \subseteq L(\phi) \cup L(\neg \nnformula)\\[1ex]
\Longleftrightarrow &\ppL{\System} \cap \stwMSCs{k} \subseteq L(\phi \vee \neg \nnformula)\,.
\end{array}\]
The latter is decidable due to Fact~\ref{p2p}.
\end{proof}

\end{comment}

\section{Synchronizability}

\begin{proposition}\label{lem:pref_stw_k+2}
	Let $k \in \N$ and $\Class \subseteq \stwMSCs{k}$. For all
	$M \in \MSCs \setminus \Class$, we have
	$(\Pref{\msc} \cap \stwMSCs{(k+2)}) \setminus \Class \neq \emptyset$.
\end{proposition}

\begin{proposition}\label{lem:onen_pref_stw_k+2}
	Let $k \in \N$ and $\Class \subseteq \stwMSCs{k}$. For all
	$M \in \onenMSCs \setminus \Class$, we have
	$(\Prefonen{\msc} \cap \stwMSCs{(k+2)}) \setminus \Class \neq \emptyset$.
\end{proposition}

\begin{proposition}\label{lem:nn_pref_stw_k+2}
	Let $k \in \N$ and $\Class \subseteq \stwMSCs{k}$. For all
	$M \in \nnMSCs \setminus \Class$, we have
	$(\Prefnn{\msc} \cap \stwMSCs{(k+2)}) \setminus \Class \neq \emptyset$.
\end{proposition}

\begin{proposition}\label{lem:continuous}
	Let $\System$ be a communicating system, $\comsymb \in \{$$\asy, $ $\oneone, $ $\co, $ $\none, $ $\onen, $ $\nn, $ $\rsc\}$,
	$k \in \N$, and $\Class \subseteq \stwMSCs{k}$.
	Then, $\cL{\System} \subseteq \Class$ iff
	$\cL{\System} \cap \stwMSCs{(k+2)} \subseteq \Class$.
\end{proposition}

\begin{theorem}\label{thm:sync}
	Fix finite sets $\Procs$ and $\Msg$.
	Let $\comsymb \in \{$$\asy, $ $\oneone, $ $\co, $ $\none, $ $\onen, $ $\nn, $ $\rsc\}$ and let $\Class \subseteq \MSCs$ be an MSO-definable and STW-bounded class (over $\Procs$ and $\Msg$).
	The following problem is decidable:
	Given a communicating system $\System$, do we have $\cL{\System} \subseteq \Class$?
\end{theorem}

\begin{comment}

\begin{lemma}\label{lem:pref_stw_k+2}
	Let $k \in \N$ and $\Class \subseteq \stwMSCs{k}$. For all
	$M \in \MSCs \setminus \Class$, we have
	$(\Pref{\msc} \cap \stwMSCs{(k+2)}) \setminus \Class \neq \emptyset$.
\end{lemma}
\begin{proof}
	Let $k$ and $\Class$ be fixed, and let
	$\msc\in \MSCs\setminus \Class$ be fixed. If the empty MSC is not in $\Class$, then we are done, since it is a valid prefix of $\msc$ and it is in $\stwMSCs{(k+2)} \setminus \Class$.
	Otherwise, let $\msc'\in \Pref{\msc} \setminus \Class$ such that, for all $\le$-maximal events $e$ of $\msc'$, removing $e$ (along with its adjacent edges) gives an MSC in $\Class$. In other words, $\msc'$ is the "shortest" prefix of $\msc$ that is not in $\Class$. We obtain such an MSC by successively removing $\le$-maximal events. Let $e$ be $\le_{\msc'}$-maximal and let $\msc''=\msc' \setminus \{e\}$. Since $\msc'$ was taken minimal in terms of number of events,	$\msc''\in \Class$.
	So Eve has a winning strategy with $k+1$ pebbles for $\msc''$.
	Let us design a winning strategy with $k+3$ pebbles for Eve for $\msc'$, which will show the claim.

	Observe that the event $e$ occurs at the end of the timeline of a process (say $p$), and it is part of at most two edges:
	\begin{itemize}
		\item one with the previous $p$-event (if any)
		\item one with the corresponding send event (if $e$ is a receive event)
	\end{itemize}
	Let $e_1,e_2$ be the two neighbours of $e$.
	The strategy of Eve is the following: in the first round, mark $e,e_1,e_2$,
	then erase the edges $(e_1,e)$ and $(e_2,e)$, then split the remaining graph
	in two parts: $\msc''$ on the one side, and the single node graph $\{e\}$ on
	the other side. Then Eve applies its winning strategy for $\msc''$, except
	that initially the two events $e_1,e_2$ are marked (so she may need up to $k+3$
	pebbles).
\end{proof}

\begin{lemma}\label{lem:onen_pref_stw_k+2}
	Let $k \in \N$ and $\Class \subseteq \stwMSCs{k}$. For all
	$M \in \onenMSCs \setminus \Class$, we have
	$(\Prefonen{\msc} \cap \stwMSCs{(k+2)}) \setminus \Class \neq \emptyset$.
\end{lemma}
\begin{proof}
	Let $k$ and $\Class$ be fixed, and let
	$\msc\in \onenMSCs \setminus \Class$ be fixed. If the empty MSC is not in $\Class$, then we are done, since it is a valid $\onen$ prefix of $\msc$ and it is in $\stwMSCs{(k+2)} \setminus \Class$.
	Otherwise, let $\msc'\in \Prefonen{\msc} \setminus \Class$ such that, for all $\onenpartial$-maximal events $e$ of $\msc'$, removing $e$ (along with its adjacent edges) gives an MSC in $\Class$. In other words, $\msc'$ is the "shortest" prefix of $\msc$ that is not in $\Class$. We obtain such an MSC by successively removing $\onenpartial$-maximal events. Let $e$ be $\onenpartial^{\msc'}$-maximal and let $\msc''=\msc' \setminus \{e\}$. Since $\msc'$ was taken minimal in terms of number of events,	$\msc''\in \Class$.
	The proof proceeds exactly as the proof of Lemma~\ref{lem:pref_stw_k+2}. 
\end{proof}

\begin{lemma}\label{lem:nn_pref_stw_k+2}
	Let $k \in \N$ and $\Class \subseteq \stwMSCs{k}$. For all
	$M \in \nnMSCs \setminus \Class$, we have
	$(\Prefnn{\msc} \cap \stwMSCs{(k+2)}) \setminus \Class \neq \emptyset$.
\end{lemma}
\begin{proof}
	Let $k$ and $\Class$ be fixed, and let
	$\msc\in \nnMSCs \setminus \Class$ be fixed. If the empty MSC is not in $\Class$, then we are done, since it is a valid $\nn$ prefix of $\msc$ and it is in $\stwMSCs{(k+2)} \setminus \Class$.
	Otherwise, let $\msc'\in \Prefnn{\msc} \setminus \Class$ such that, for all $\nnbowtieofmsc\msc$-maximal events $e$ of $\msc'$, removing $e$ (along with its adjacent edges) gives an MSC in $\Class$. In other words, $\msc'$ is the "shortest" prefix of $\msc$ that is not in $\Class$. We obtain such an MSC by successively removing $\nnbowtieofmsc\msc$-maximal events. Let $e$ be $\nnbowtieofmsc{\msc'}$-maximal and let $\msc''=\msc' \setminus \{e\}$. Since $\msc'$ was taken minimal in terms of number of events,	$\msc''\in \Class$.
	The proof proceeds exactly as the proof of Lemma~\ref{lem:pref_stw_k+2}. 
\end{proof}

Note that Lemma~\ref{lem:continuous} can be extended to $\comsymb = \cosymb$, since Lemma~\ref{lem:continuous2} does not depend on the kind of communication used by the system. 

\begin{lemma}\label{lem:continuous_co}
Let $\System$ be a communicating system, $\comsymb \in \{\ppsymb, \mbsymb, \cosymb\}$,
$k \in \N$, and $\Class \subseteq \stwMSCs{k}$.
Then, $\cL{\System} \subseteq \Class$ iff
$\cL{\System} \cap \stwMSCs{(k+2)} \subseteq \Class$.
\end{lemma}

\begin{lemma}\label{lem:continuous_onen}
Let $\System$ be a communicating system,
$k \in \N$, and $\Class \subseteq \stwMSCs{k}$.
Then, $\onenL{\System} \subseteq \Class$ iff
$\onenL{\System} \cap \stwMSCs{(k+2)} \subseteq \Class$.
\end{lemma}
\begin{proof}
	Follows from Lemma~\ref{lem:onen-prefix-closed} and Lemma~\ref{lem:onen_pref_stw_k+2}.
\end{proof}

\begin{lemma}\label{lem:continuous_nn}
Let $\System$ be a communicating system,
$k \in \N$, and $\Class \subseteq \stwMSCs{k}$.
Then, $\nnL{\System} \subseteq \Class$ iff
$\nnL{\System} \cap \stwMSCs{(k+2)} \subseteq \Class$.
\end{lemma}
\begin{proof}
	Follows from Lemma~\ref{lem:nn-prefix-closed} and Lemma~\ref{lem:nn_pref_stw_k+2}.
\end{proof}

Theorem~\ref{thm:sync} can also be extended to $\comsymb = \cosymb$.

\begin{theorem}\label{thm:sync_co}
Fix finite sets $\Procs$ and $\Msg$.
Suppose $\comsymb \in \{\ppsymb, \mbsymb,\cosymb\}$ and let $\Class \subseteq \MSCs$ be an MSO-definable and STW-bounded class (over $\Procs$ and $\Msg$).
The following problem is decidable:
Given a communicating system $\System$, do we have $\cL{\System} \subseteq \Class$?
\end{theorem}
\begin{proof}
Same as the proof for Theorem~\ref{thm:sync}, but using Lemma~\ref{lem:continuous_co} in place of Lemma~\ref{lem:continuous}, and Theorem~\ref{thm:co_bounded_model_checking} in place of Theorem~\ref{thm:mailbox_bounded_model_checking}.
\end{proof}

\begin{theorem}\label{thm:sync_onen}
Fix finite sets $\Procs$ and $\Msg$.
Let $\Class \subseteq \MSCs$ be an MSO-definable and STW-bounded class (over $\Procs$ and $\Msg$).
The following problem is decidable:
Given a communicating system $\System$, do we have $\onenL{\System} \subseteq \Class$?
\end{theorem}
\begin{proof}
Same as the proof for Theorem~\ref{thm:sync}, but using Lemma~\ref{lem:continuous_onen} in place of Lemma~\ref{lem:continuous}, and Theorem~\ref{thm:onen_bounded_model_checking} in place of Theorem~\ref{thm:mailbox_bounded_model_checking}.
\end{proof}

\begin{theorem}\label{thm:sync_nn}
	Fix finite sets $\Procs$ and $\Msg$.
	Let $\Class \subseteq \MSCs$ be an MSO-definable and STW-bounded class (over $\Procs$ and $\Msg$).
	The following problem is decidable:
	Given a communicating system $\System$, do we have $\nnL{\System} \subseteq \Class$?
	\end{theorem}
\begin{proof}
Same as the proof for Theorem~\ref{thm:sync}, but using Lemma~\ref{lem:continuous_nn} in place of Lemma~\ref{lem:continuous}, and Theorem~\ref{thm:nn_bounded_model_checking} in place of Theorem~\ref{thm:mailbox_bounded_model_checking}.
\end{proof}

\end{comment}
