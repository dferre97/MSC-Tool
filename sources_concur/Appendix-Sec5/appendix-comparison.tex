%!TEX root = ../concur2021.tex

%\subsection{Proofs for section 5 } \label{sec:app-relations}

%\begin{theorem}\label{theorem:strong_equal_weak_p2p}
%	A peer-to-peer MSC is \skSous{k} iff it is weakly-$k$-synchronous.
%\end{theorem}

\subsection{Proofs}
\label{app:stronglykp2p}
%\strongequalweakptop*
%
\input{Appendix-Sec5/proof_strong_equal_weak_ptop}



\synchroinexists*
\input{Appendix-Sec5/proof_synchro_in_exists}

\weakuniveruweak*

\input{Appendix-Sec5/proof_weak_univer_uweak}


\subsection{Examples}


%\comL{to  move for arxiv version}



\subsubsection{\pp systems }
For p2p semantics,
\wS{} and \sS{} systems form a single class, as \sks{k} and \wks{k} form a single class too.
Indeed, as a consequence of Proposition~\ref{proposition:strong_equal_weak_p2p}, \wks{k}  systems are \sks{k}, and \wS{} are \sS{}.
Therefore, for this \pp part, we will only talk about weak classes.
We will see that this is not the case for mailbox systems.

However, \ub{} and \eb{} classes are not equal, an \ub{} system is \eb{} by definition but we can find a \eb{} system, as system $\systemexist$ in Fig.~\ref{fig:system_exist} where, as we can see in a corresponding MSC in Fig.~\ref{fig:msc_exist}, an unbounded number of $\msg_3$ can be sent before be read by $r$, which prevent the system to be \ub{}.

\begin{center}
%  \begin{minipage}[c]{7cm}
    \input{Appendix-Sec5/system_exist}
%\end{minipage}
%\hspace*{1cm}
% \begin{minipage}[c]{3.5cm}
% \input{Appendix-Sec5/msc_exist}
% \end{minipage}
 \end{center}


By definition, \wks{k} systems are \wS{}.
Also, \sks{k} systems are included into \ekb{k} systems, as proved by Proposition~\ref{proposition:synchro_in_exists}, so \wks{k} are included into \ekb{k}.

We can see that \wS{} systems and \eb{} systems are incomparable. System
$\systemWSexist$ in Fig.~\ref{fig:system_W_S_exist} is \wS{}
%(and so \sS{})
because we
can send all messages before read them, and \ekb{1} because each MSC of
$\ppL{\systemWSexist}$ has a linearization of the form $\send{q}{p}{\msg_2} \cdot
(\send{p}{q}{\msg_1} \cdot \rec{p}{q}{\msg_1})^* \rec{q}{p}{\msg_2}$,  allowing
to have in each channel only one pending message.

\begin{center}
  \begin{minipage}[c]{6cm}
    \input{Appendix-Sec5/system_W_S_exist}
\end{minipage}
\hspace*{1cm}
\begin{minipage}[c]{3.5cm}
  \input{Appendix-Sec5/msc_W_S_exist}
\end{minipage}
\end{center}


But, system $\systemWS$ in
Fig.\ref{fig:system_W_S} is only \wS{}. Indeed, for each execution we can add an
iteration of message $\msg_1$ or $\msg_2$, or both, and, as we can see in
Fig.~\ref{fig:msc_W_S}, we need to send all
messages before begin to read, and so each execution need a bigger channel than
the previous one.
\begin{center}
  \begin{minipage}[c]{6cm}
\input{Appendix-Sec5/system_W_S}
\end{minipage}
\hspace*{1cm}
\begin{minipage}[c]{3.5cm}
\input{Appendix-Sec5/msc_W_S}
\end{minipage}
\end{center}

For system $\systemuniver$ in Fig.~\ref{fig:system_univer}, we
can see an example of MSC in Fig.~\ref{fig:msc_univer} which cannot be divided
into exchanges as send and receptions are intertwined and so $\systemuniver$ is not
\wS{}.

\begin{center}
  \begin{minipage}[c]{6cm}
    \input{Appendix-Sec5/system_univer}
\end{minipage}
\hspace*{1cm}
\begin{minipage}[c]{3.5cm}
  \input{Appendix-Sec5/msc_univer}
\end{minipage}
\end{center}




We can observe that $\systemuniver$ is \ukb{3} as each time a
message is sent, one is received and
the maximal number of messages in a buffer is 3. As we said, $\systemWS$ is \wS{} but not \eb{} and so not \ub{}, so \wS{} and \ub{} systems are incomparable.
However, as proved in Proposition~\ref{proposition:weak_univer_uweak}, a system which is both is also \wks{k} (not necessarly for the same $k$).

Finally, \wks{k} and \ukb{k} systems are incomparable. System $\systemweakuniver$ in
Fig.~\ref{fig:system_weak_univer} is  both weakly 1-synchronizable and
universally 1-bounded.   But,  we have, for example, system $\systemweakSexist$ below
which is \wks{1} but not \ukb{k} for any $k$.  Indeed,
each execution can be rescheduled to have all the receptions just after the
respective sends. Then each MSC can be divided into \kE{1}s  (for an example,
see  MSC $\mscweakSexist$ in Fig.~\ref{fig:msc_weak_S_exist}). However, as we can send an
unbounded number of $\msg_2$ messages before reading them, the size of channel
$c_p$ can also be unbounded thus the system is not universally bounded.
Conversely, as we have seen, system $\systemuniver$ is \ukb{3} but not \wks{k} for any $k$.
\input{Appendix-Sec5/system_weak_S_exist}


\subsubsection{Mailbox systems }

Now consider  mailbox semantics. As depicted in Fig. \ref{fig:diagram_mailbox_all}, we can now distinguish between weakly and strongly synchronizable systems.

Some inclusions are obvious, by definition of the classes:
\begin{itemize}
  \item \ub{} systems are \eb{}, but it is a proper inclusion. Indeed, a system, as system $\systemexist$ in Fig.~\ref{fig:system_exist}, can be \ekb{1}, but not \ub{}. In this case, as in \pp semantics, an unbounded number of message $\msg_3$ can be sent before be read, as we can see in MSC $\mscexist$ in Fig.~\ref{fig:msc_exist}.
  \item \sks{k} systems are \sS{}. As well, a system can be \sS{} without have a bound on the size of its exchange, as system $\systemWS$ in Fig~\ref{fig:system_W_S}. See an example of MSC of $\systemWS$ in Fig~\ref{fig:msc_W_S}, where we can always build a bigger exchange adding iterations of messages $\msg_1$ or $\msg_2$.
  \item \wks{k} systems are \wS{}. We can also find a \wS{} system without bound on the size of its exchange. Let see $\systemW$ in Fig.~\ref{fig:system_W} with MSC $\mscW$ in Fig.~\ref{fig:msc_W}, which can be divided into exchanges, each message can be in a separate exchange, except messages $\msg_2$ and $\msg_3$ that have to be all in the same exchange. As we can have as many repetitions of them, this exchange no have bound on its size and prevent the system to be \wks{k} for a precise $k$.
\end{itemize}




%
% \begin{center}
%   \begin{minipage}[c]{6cm}
     \input{Appendix-Sec5/system_W}
% \end{minipage}
% \hspace*{1cm}
% \begin{minipage}[c]{3.5cm}
%   \input{Appendix-Sec5/msc_W}
% \end{minipage}
% \end{center}


The classes of \wS{} and \wks{k} systems are incomparable with the classes of \eb{} and \ub{} systems.

Indeed, let see system $\systemuniver$ in Fig.~\ref{fig:system_univer} which is \ukb{3}. It cannot be \wS{} (and so \wks{k} for a $k$) as we cannot divide a corresponding MSC, as $\mscuniver$ in Fig.~\ref{fig:msc_univer}, into exchanges, where all sends have to be before all receptions, as in \pp semantics.
We see a difference with the \pp semantics looking at $\systemweak$ in
Fig.~\ref{fig:system_weak} which is \wS{} but not \eb{}. Indeed, we can see in
Fig.~\ref{fig:msc_weak} that $\mscweak$ can be divided easily into \kE{1} but,
as $\msg_1$ has to be sent before $\msg_4$, and $\msg_2$ has to be sent to send
$\msg_4$,  it means  that all messages $\msg_2$ have to wait the send of
$\msg_4$ to be read.  Then, each execution is $x$-mailbox-bounded, where $x$ is
the number of repetitions of $\msg_2$. Then, there is no bound on the buffers
and $\systemweak$ cannot be \eb{} (and so \ub{}).



\begin{center}
  \begin{minipage}[c]{6cm}
    \input{Appendix-Sec5/system_weak}
\end{minipage}
\hspace*{1cm}
\begin{minipage}[c]{3.5cm}
  \input{Appendix-Sec5/msc_weak}
\end{minipage}
\end{center}


Finally, as proved in Proposition~\ref{proposition:weak_univer_uweak}, if a system is \wS{} and \ub{} system, there is a $k$ such that it is also \sks{k}. In all the other intersections, we can find a system:
\begin{itemize}
  \item \wS{} and \eb{} (but not \wks{k} or \ub{}): $\systemWexist$ in Fig.~\ref{fig:system_W_exist} is \ekb{1} but there is no bound on the size of the exchange containing messages $\msg_3$ and $\msg_4$ and so $\systemWexist$ cannot be \wks{k}, and repetitions of $\msg_3$ prevent it to be \ub{};
\end{itemize}
  \begin{center}
    \begin{minipage}[c]{6cm}
      \input{Appendix-Sec5/system_W_exist}
  \end{minipage}
  \hspace*{1cm}
  \begin{minipage}[c]{3.5cm}
    \input{Appendix-Sec5/msc_W_exist}
  \end{minipage}
  \end{center}
  \begin{itemize}
      \item \wks{k} and \eb{} (but not \ub{}): $\systemweakexist$ in Fig.~\ref{fig:system_weak_exist} is \wks{1} and \ekb{1} but repetitions of $\msg_3$ prevent it from being \ub{};
  \end{itemize}
  \begin{center}
    \begin{minipage}[c]{6cm}
      \input{Appendix-Sec5/system_weak_exist}
  \end{minipage}
  \hspace*{1cm}
  \begin{minipage}[c]{3.5cm}
    \input{Appendix-Sec5/msc_weak_exist}
  \end{minipage}
  \end{center}
\begin{itemize}
  \item \wks{k} and \ub{} as $\systemuniver$ in Fig.~\ref{fig:system_weak_univer}.

\end{itemize}







Now, focus on the strong classes. We know by
Proposition~\ref{proposition:synchro_in_exists} that a \sks{k} is \eb{}. So let
compare \sks{k} systems with \ub{} ones.  We can see that there are incomparable.
$\systemstrongexist$ in Fig.~\ref{fig:system_strong_exist} is \sks{1}, as we can
see with $\mscstrongexist$ in Fig.~\ref{fig:msc_strong_exist}, but cannot be \ub{} as
the unbounded iterations of $\msg_1$ can be stored before begin to read.
As we see before $\System_7$ is only \ub{} and cannot have any synchronizable property. But, $\systemstronguniver$ in Fig.~\ref{fig:system_strong_univer} is both \sks{1} and \ukb{1}.

% \begin{center}
%   % \begin{minipage}[c]{6cm}
%
% % \end{minipage}
% % \hspace*{1cm}
% % \begin{minipage}[c]{3.5cm}
% %   \input{Appendix-Sec5/msc_strong_exist}
% % \end{minipage}
% \end{center}


% \begin{center}
%   \input{Appendix-Sec5/system_strong_exist}
% \end{center}

\begin{center}
  \begin{minipage}[c]{8cm}
    \input{Appendix-Sec5/system_strong_exist}
    \input{Appendix-Sec5/system_strong_univer}
\end{minipage}
\hspace*{1cm}
\begin{minipage}[c]{3.5cm}
  \input{Appendix-Sec5/msc_strong_univer}
\end{minipage}
\end{center}


Similarly, \sS{} systems are incomparable with \eb{} ones.
$\systemweakS$ in Fig.~\ref{fig:system_weak_S} is \sS{} (and also \wks{1})
but, to get an execution from $\mscweakS$ we need to send message $\msg_5$ before $\msg_1$ and, as we see with $\msc_6$ previously, the number of iterations of $\msg_2$ becomes the bound of the channels for this execution. As it is unbounded, the system cannot be \eb{}.

\begin{center}
  \begin{minipage}[c]{8cm}
    \input{Appendix-Sec5/system_weak_S}
\end{minipage}
\hspace*{1cm}
\begin{minipage}[c]{3.5cm}
  \input{Appendix-Sec5/msc_weak_S}
\end{minipage}
\end{center}


$\systemWexist$ in Fig.~\ref{fig:system_W_exist} is \eb{} and \wS{}, but, again, message $\msg_5$ have to be sent before $\msg_1$, so all messages in $\mscWexist$ have to be in the same exchange. However, on process $r$, receptions of $\msg_3$ precedes send of $\msg_5$ and so this is not an exchange, and the system is not \sS{}.

%\input{system_W_exist}

For the intersection, as with weak, a \sS{} and \eb{} systems is always \sks{k} for a $k$, by Proposition~\ref{proposition:weak_univer_uweak}. We can have for example, $\systemW$ which is \sS{}, \ub{}, \wks{1}
 but, as an exchange have to contain all messages that we have in $\msc_3$, and we can repeat $\msg_2$ as many times we want, an exchange in mailbox is no bounded, and the system is not \sks{k} for any $k$.
 We can also have $\systemWSexist$ in Fig.~\ref{fig:system_W_S_exist} which is \sS{} and \eb{} but, as one execution is always an exchange, and it can grow without limits, we cannot be neither \sks{k} nor \wks{k} for any $k$.

 %\input{system_W_S_exist}


%, and weakly synchronizable systems become incomparable with respect to existentially bounded.

%\input{diagram-mailbox-classes}

%Proposition \ref{theorem:synchro_in_exists_p2p} needs to be adapted to mailbox semantics.

%
%
% \begin{restatable}{proposition}{stronginexistsmailbox}\label{theorem:strong_in_exists_mailbox}
% 	Every \skSous{k} mailbox MSC is existentially $k$-mailbox-bounded.
% \end{restatable}
% ---------------------OLD VERSION
%
%
% By definition, \sS mailbox systems are \wS, as each MSC can be divided into exchange.
% In the same way, any \sks{k} mailbox system is \wks{k}, as each MSC can be decomposed into \kE{k}s. Note that if a system is \sks{k} with the smallest possible $k$, it can be \wks{k'} with  $k'<k$.
% However, this  is a proper inclusion. Indeed  system $\System_2$ in Fig.~\ref{fig:system_weak_exist} (when we consider the mailbox semantics)  is \wks{1} but not \sks{k} for any $k$. Messages $\msg_1$ and $\msg_3$ are constrained to be in the same \kE{k} but as we can have an unbounded number of sends and reception of $\msg_2$, the size of the \kE{k} is unbounded as well. Notice that this system is also \ekb{1}.
%
% %MSC $M_2$ in Fig.~\ref{fig:msc_weak_exist} is strongly-$3$-synchronous. But, if we add an iteration of message $\msg_2$, the corresponding MSC is strongly-$4$-synchronous. Finally, the size of the \kE{k}s is not bounded.
%
%
% Similarly, any \ukb{k} mailbox system is also \ekb{k} as all linearizations are bounded. However, the bound can  be smaller and so the system can sometimes be \ekb{k'} with $k'<k$.
% This is also a proper inclusion. Take, for instance, system $\System_5$ in Fig.~\ref{fig:system_exist}, %and an example of MSC with $M_5$ in Fig.~\ref{fig:msc_exist}
% which %, if we imagine an unbounded number of repetions of $\msg_3$,
% is \ekb{1} but not \ukb{k} for any $k$, as channel $c_r$  can be unbounded  because of the loops for  $\send{q}{r}{\msg_3}$.
% \input{system_exist}
%
%
%
% The class of weakly synchronizable systems is incomparable with the class of existentially bounded. Indeed,   system $\System_6$ below is \wks{1} but  not \ekb{k} for any $k$. As exemplified in Fig. \ref{fig:msc_weak}, MSCs can be  divided into \kE{1}s.  But when we linearize them, $\msg_4$ has to be sent before $\msg_1$ and  all messages $\msg_2$ have to be sent before  $\msg_4$. The reception of  $\msg_2$ can start only when $\msg_1$ has been sent. Hence  we can have an unbounded number of $\msg_2$ and therefore the size of channel $c_q$ is also unbounded.
% \begin{center}
%  \noindent
%  \begin{minipage}[b]{7.75cm}
% \input{system_weak}
% \end{minipage}
%  \begin{minipage}[b]{4cm}
%    \input{msc_weak}
%  \end{minipage}
%
%  \end{center}
%
%
% As for \pp semantics,  universally bounded systems are incomparable with the weakly synchronizable ones.
% There are systems in both classes like $\System_1$ in Fig.~\ref{fig:system_weak_univer} which is \ukb{1} and \wks{1}. Some systems are \ukb{k} but not \wks{k'} for any $k'$ as $\System_3$ in Fig.~\ref{fig:system_univer}:  notice that a system, with two machines only, behaves in the same way in the \pp and mailbox semantics, thus the discussion presented above works for the mailbox semantics as well.
% %The MSC $M_3$ in Fig.~\ref{fig:system_univer} shows a possible behaviour of this system which cannot be divided into \kE{k}s, all messages of the execution have to be in the same \kE{k} but we cannot put all sends before all receptions. On the other hand, we see that each executions is at most $2$-bounded, as we need to read to send an other message.
% System $\System_4$ below is \wks{1} (and \sks{1}) but not \ukb{k} for any $k$. Indeed, channel $c_p$ can be filled by an unbounded number of messages $\msg_1$.
% \input{system_strong_exist}
% The class of universally bounded systems is also incomparable with the classes of strongly synchronizable systems.
% As for \pp, system $\System_3$ is not \sks{k}  for any $k$ but  it is  \ukb{3}.  Still the properties are not incompatible,  for instance, system $\System_7$ below  is both \ukb{1} and \sks{1}.
% \begin{center}
%  \noindent
%  \begin{minipage}[b]{5cm}
% \input{system_strong_univer}
%  \end{minipage}
%  \begin{minipage}[b]{5cm}
% \input{msc_strong_univer}
%  \end{minipage}
%  \end{center}
